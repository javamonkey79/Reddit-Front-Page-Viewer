<html>
	<head>
		<link rel="shortcut icon" 
      type="image/x-icon" 
      href="http://www.redditstatic.com/favicon.ico">
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
		<!-- using the jquery url parser: https://github.com/allmarkedup/jQuery-URL-Parser -->
		<script type="text/javascript" src="https://raw.github.com/allmarkedup/jQuery-URL-Parser/master/jquery.url.js"></script>
		<script type="text/javascript">
			var seenUrls = [];
			
			function loadAllAndPics(){
				load('day','all');
				load('day','pics');
			}
			function load(time, subreddit) {
				$("#content").html("");
				
				$.getJSON( "http://www.reddit.com/r/" + subreddit + "/top/.json?sort=top&t=" + time + "&jsonp=?", function(json) {
				  $.each(json.data.children, function(i,item){
						var iData = item.data;
						var commentLink = "http://www.reddit.com" + iData.permalink;
						var url = iData.url;
						
						if( seenUrls.indexOf( url ) != -1 ){
							return;
						}
						
						if( commentLink.indexOf( "gonewild" ) != -1 ){
							appendBreak();
							
							$("<a href='"+commentLink+"' target='_blank'><span style='background-color:red'>SKIPPED: GONE, WILD</span></a>").appendTo("#content");	
							appendBreak();
							
							return;
						}
						
						seenUrls.push( url );
						
						var imgurAlbumPattern = new RegExp("http://imgur\\.com/a/\\w+");
						var imagePattern = new RegExp("\\.(gif|jpg|png|jpeg)");
						
						var endsWithFileExtension = imagePattern.test( url );
						var imgurAlbum =  imgurAlbumPattern.test( url );
						
						/*
						console.debug( "url: {" + url + "} - albumImgur: {" + albumImgur + 
							"} - extension: {" + extension + "} - endsWithFileExtension: {" + endsWithFileExtension + "}" );
						*/

						$("<h1>" + iData.title + "</h1>").appendTo("#content");
						$("<a href='"+commentLink+"' target='_blank'>Comments</a>").appendTo("#content");	
						appendBreak();
						
						var imageUrl = endsWithFileExtension ? url : url + ".jpg";
						if( endsWithFileExtension || ( url.indexOf( "imgur" ) != -1 && !imgurAlbum ) ) {
							// handle images
							$("<a href='"+url+"' target='_blank'><img id=redditImg"+i+" src='"+imageUrl+"' style='width: 75%; height: 75%;' /></a>").appendTo("#content");
						} else {
							// drop a link to it just in case we can't wrap it in an iframe
							$("<a href='"+url+"' target='_blank'>Open In New Tab</a><br/>").appendTo("#content");
							
							if(url.indexOf("youtube") != -1 || url.indexOf("youtu.be") != -1){
								var parsedUrl = $.url( url );
								var videoId = parsedUrl.param( 'v' );
								if(videoId == undefined){
									var youtubeRegex = /(?:http:\/\/)?(?:www\.)?(?:youtu\.be)\/(.+)/g;
									url = url.replace(youtubeRegex, "http://www.youtube.com/embed/$1")
								}else{
									url = "http://www.youtube.com/embed/" + videoId;
								}
								
								//console.debug("youtube url: " + url);
								
								$("<iframe class='youtube-player' src='"+url+"' style='width: 75%; height: 75%;'/>").appendTo("#content");								
							}else if(imgurAlbum) {
								// handle imgur albums
								$("<iframe src='"+url+"' style='width: 75%; height: 75%;'/>").appendTo("#content");								
							}else if(url.indexOf("qkme.me") != -1) {
								// handle quick meme
								
								url = "http://i." + $.url(url).attr("host") + $.url(url).attr("path") + ".jpg";
								
								$("<a href='"+url+"' target='_blank'><img id=redditImg"+i+" src='"+url+"' style='width: 75%; height: 75%;' /></a>").appendTo("#content");
							}else {
								$("<a href='javascript:void(0)' id='showme"+i+"' onclick=showIFrame('showme"+i+"','"+url+"')>Show iFrame</a><br/>").appendTo("#content");
							}
						}
						appendBreak();
			    });
				});
			}
			
			function showIFrame(idAppendTo,url){
				$("<br/>").appendTo("#"+idAppendTo);
				$("<iframe src='"+url+"' style='width: 75%; height: 75%;'/>").appendTo("#"+idAppendTo);
			}
			
			function appendBreak(){
				$("<br/>").appendTo("#content");
			}
		</script>
	</head>
	<body onload="loadAllAndPics()">
		<div id="content" />	
	</body>
</html>